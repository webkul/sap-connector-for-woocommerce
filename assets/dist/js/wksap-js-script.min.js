function wksap_sweet_alert(e,a=""){Swal.fire({icon:"warning",title:e,text:a})}function wkSAPvalidateform(){var e=document.myForm.wwsconnector_username.value,a=document.myForm.wwsconnector_password.value,t=document.myForm.wwsconnector_sapdb.value,o=document.myForm.wwsconnector_instance.value,n=document.myForm.wwsconnector_sap_prefix.value,s=document.myForm.wwsconnector_sap_license_key.value;return null==e||""==e?(wksap_sweet_alert(wksap_ajax_object.translation.username),!1):null==a||""==a?(wksap_sweet_alert(wksap_ajax_object.translation.password),!1):null==t||""==t?(wksap_sweet_alert(wksap_ajax_object.translation.company),!1):null==o||""==o?(wksap_sweet_alert(wksap_ajax_object.translation.service),!1):null==n||""==n?(wksap_sweet_alert(wksap_ajax_object.translation.sap_prefix),!1):null==s||""==s?(wksap_sweet_alert(wksap_ajax_object.translation.licence_key),!1):n.length>3?(wksap_sweet_alert(wksap_ajax_object.translation.prefix_3),!1):n.length<3?(wksap_sweet_alert(wksap_ajax_object.translation.prefix_2),!1):void 0}function wkSAPinitilaizeConnection(e){if("P"==e){window.connectionType="production",sap_userName=document.getElementById("wwsconnector_username").value,sap_password=document.getElementById("wwsconnector_password").value,sap_db=document.getElementById("wwsconnector_sapdb").value,sap_instance=document.getElementById("wwsconnector_instance").value,sap_prefix=document.getElementById("wwsconnector_sap_prefix").value,sap_license_key=document.getElementById("wwsconnector_sap_license_key").value;var a={UserName:sap_userName,Password:sap_password,CompanyDB:sap_db,instance:sap_instance,sap_prefix:sap_prefix,sap_license_key:sap_license_key};jQuery("#wksap_connector_data").val(JSON.stringify(a)),jQuery("#wksap-form").submit()}}$=jQuery.noConflict(),jQuery(function(e){function a(e){return msgBlock='<span id="wksap_notice_block">',msgBlock+="<br>",msgBlock+='<span id="completed_b">0</span>% '+wksap_ajax_object.translation.completed+" ",msgBlock+="<br>",msgBlock+='<span id="current_option_going">'+wksap_ajax_object.translation.fetch_logs+"</span>",msgBlock+="<hr>",msgBlock+=wksap_ajax_object.translation.time_elapsed+' <span id="'+e+'">00:00:00</span>',msgBlock+="<br>",msgBlock+='<span id="wpsap_end_notice"></span>',msgBlock+="</span>",msgBlock}function t(e){var a=0;window.counter_block_id=setInterval(function(){if(a+=1,"yes"==window.stop_clock)return void clearInterval(window.counter_block_id);var t=a%60,o=Math.floor(a/60),n=Math.floor(o/60);(n%=60)<10&&(n="0"+n);(o%=60)<10&&(o="0"+o);t<10&&(t="0"+t);jQuery("#"+e).html(n+":"+o+":"+t)},1e3)}function o(e,a,t){var o='<div class="'+e+' notice is-dismissible" id="error_response">        \t\t<p> <strong>'+a+" </strong> "+t+'</p>        \t\t<button class="notice-dismiss" type="button">        \t\t\t<span class="screen-reader-text">'+wksap_ajax_object.translation.dismiss_notice+"</span>        \t\t</button>        \t</div>";jQuery("#wksap_my_wrap").prepend(o)}function n(e,a,t,s,r,i,c,_){if(!wksap_ajax_object?.wksap_enable)return void Swal.fire({title:wksap_ajax_object.translation.error,text:wksap_ajax_object.translation.enable_plugin,icon:"error",showConfirmButton:!0,timer:3e3});let l=`\n                <span id="current_option_going">\n                    <b id="b_added">${c}</b> added /\n                    <b id="b_updated">${i}</b> updated /\n                    <b id="b_errors">${_}</b> errors of\n                    <b id="b_total_records">${e}</b> records\n                </span>`;if(jQuery("#current_option_going").html(l),window.user_item_ids.length>0){window.formSubmitting=!1,r+=1;const l=window.user_item_ids[0],p={action:"wksap_woo_export_users",user_id:l,wksap_nonce:wksap_ajax_object.wksap_nonce};jQuery.ajax({type:"POST",url:wksap_ajax_object.wksap_ajax,data:p,beforeSend:function(){jQuery("#synchronizeusers_id").addClass("is-active");const e=jQuery("#wksap_my_wrap");e.hasClass("processing")||(jQuery(".spinner").addClass("is-active"),e.addClass("processing").css({position:"relative",opacity:.6,backgroundColor:"#fff"}))},success:function(p){try{const o=JSON.parse(p);if(""!==o.error?(jQuery("#sync_status_icon_"+l).attr("title",o.error),jQuery("#sync_status_icon_"+l).css("color","red"),jQuery("#sync_status_icon_"+l).removeClass("dashicons-yes"),jQuery("#sync_status_icon_"+l).addClass("dashicons-welcome-comments")):(jQuery("#sync_status_icon_"+l).css("color","green"),jQuery("#sync_status_icon_"+l).addClass("dashicons-yes"),jQuery("#sync_status_icon_"+l).removeClass("dashicons-welcome-comments"),jQuery("#sync_status_icon_"+l).attr("title","")),o.total){const l=window.user_item_ids[0];o.updated?jQuery("#add_sf_sync_time_"+l).html(o.syncc_time):o.added&&(jQuery("#add_sap_user_id_"+l).html(o.sap_user_id),jQuery("#add_sf_sync_time_"+l).html(o.syncc_time)),a-=t;let p=(s=r*t)/e*100;p>100&&(p=100),jQuery("#completed_b").text(parseInt(p)),i=o.updated+parseInt(jQuery("#b_updated").text()),c=o.added+parseInt(jQuery("#b_added").text()),_=o.errorsValue+parseInt(jQuery("#b_errors").text()),window.user_item_ids.shift(),n(e,a,t,s,r,i,c,_)}}catch(e){jQuery(".spinner").removeClass("is-active"),jQuery("#wksap_my_wrap").removeClass("processing").css({opacity:1}),jQuery("#wpsap_end_notice").append("<mark class='incomplete tips' style='background-color:red;color:white;'>"+wksap_ajax_object.translation.completed+"</mark>"),window.stop_clock="yes",o("error",wksap_ajax_object.translation.error_ex,p)}},error:function(e){window.formSubmitting=!0,jQuery(".spinner").removeClass("is-active"),jQuery("#wksap_my_wrap").removeClass("processing").css({opacity:1}),jQuery("#wpsap_end_notice").append("<mark class='incomplete tips' style='background-color:red;color:white;'>"+wksap_ajax_object.translation.completed+"</mark>"),window.stop_clock="yes",o("error",wksap_ajax_object.translation.error_ex,e.responseText)},complete:function(){0===window.user_item_ids.length&&(jQuery(".spinner").removeClass("is-active"),jQuery("#wksap_my_wrap").removeClass("processing").css({opacity:1}),window.formSubmitting=!0,jQuery("#synchronizeusers_id").removeClass("is-active"),jQuery("#wpsap_end_notice").append("<mark class='completed tips'>"+wksap_ajax_object.translation.completed+"</mark>"),window.stop_clock="yes",window.disableuser=!1,clearInterval(window.counter_block_id),"yes"===window.sync_all&&(window.sync_all="no"),setTimeout(function(){location.reload()},1e3))}})}else jQuery(".spinner").removeClass("is-active"),jQuery("#wksap_my_wrap").removeClass("processing").css({opacity:1}),window.formSubmitting=!0,jQuery("#synchronizeusers_id").removeClass("is-active"),jQuery("#wpsap_end_notice").append("<mark class='completed tips'>"+wksap_ajax_object.translation.completed+"</mark>"),window.stop_clock="yes",window.disableuser=!1,clearInterval(window.counter_block_id),"yes"===window.sync_all&&(window.sync_all="no"),setTimeout(function(){location.reload()},1e3)}function s(e,a=""){Swal.fire({icon:"warning",title:e,text:a})}function r(e,a,t=""){e=e.charAt(0).toUpperCase()+e.slice(1),"unlink"==a&&""==t?$msg=wksap_ajax_object.translation.no+e+wksap_ajax_object.translation.select_unlink:"export"==a?$msg=wksap_ajax_object.translation.no+e+wksap_ajax_object.translation.select_export:"import"==a?$msg=wksap_ajax_object.translation.no+e+wksap_ajax_object.translation.select_import:("unlink"==a&&""!=t||"dateFiler"==a)&&($msg=t),Swal.fire({title:wksap_ajax_object.translation.warning,text:$msg,icon:"info",showConfirmButton:!1,timer:3e3,timerProgressBar:!0}).then(()=>{location.reload()})}function i(e,a){if(!wksap_ajax_object?.wksap_enable)return void Swal.fire({title:wksap_ajax_object.translation.error,text:wksap_ajax_object.translation.enable_plugin,icon:"error",showConfirmButton:!0,timer:3e3});let t=wksap_ajax_object.translation.selected_unlink_mapping;wksap_ajax_object.translation.all_mapping_unlink;if("user"==a){if("delete-user"==e){let n=null,s=0,i=jQuery("input[name='mergeduser[]']:checkbox:checked");if(i.length>0){let e=i.map(function(){return this.value}).get();s=e.filter(e=>!document.getElementById("row_"+e)).length,s===e.length?(n=0,r(a,"unlink",wksap_ajax_object.translation.no_mapping_available),event.preventDefault()):n=1}null!=n&&1!=n||(window.user_item_ids=new Array,jQuery("input[name='mergeduser[]']:checkbox").each(function(){1==jQuery(this).prop("checked")&&(item_id=jQuery(this).val(),window.user_item_ids.push(item_id))}),window.user_item_ids.length>0?jQuery.ajax({type:"POST",url:wksap_ajax_object.wksap_ajax,data:{action:"wksap_delete_mapping_data",deleteIds:window.user_item_ids,process:e,sObject:a,wksap_nonce:wksap_ajax_object.wksap_nonce},beforeSend:function(){},success:function(e){Swal.fire({title:wksap_ajax_object.translation.unlinked,text:t,icon:"success",timer:2e3,showConfirmButton:!1,showCancelButton:!1}).then(e=>{location.reload()})},error:function(e){o("error",wksap_ajax_object.translation.error_ex,e.responseText)},complete:function(){}}):r(a,"unlink"))}"delete-all-user"==e&&jQuery.ajax({type:"POST",url:wksap_ajax_object.wksap_ajax,data:{action:"wksap_delete_mapping_data",process:e,sObject:a,wksap_nonce:wksap_ajax_object.wksap_nonce},success:function(e){e?Swal.fire({title:wksap_ajax_object.translation.success,text:wksap_ajax_object.translation.all_unlinked,icon:"success",showConfirmButton:!1,timer:3e3,timerProgressBar:!0}).then(function(){location.reload()}):Swal.fire({title:wksap_ajax_object.translation.warning,text:wksap_ajax_object.translation.no_records_mapping,icon:"info",showConfirmButton:!1,timer:2e3,timerProgressBar:!0}).then(function(){location.reload()})},error:function(e){o("error",wksap_ajax_object.translation.error_ex,e.responseText)},complete:function(){}})}}window.stop_clock="yes",window.formSubmitting=!0,window.sapConnection="",window.locator="",window.counter_block_id="",window.disableprod=!1,window.disablecat=!1,window.disableorder=!1,window.disableuser=!1,window.allowAlert=wksap_ajax_object.translation.import_duplicates,window.item_ids=new Array,window.sync_all="",window.onload=function(){window.addEventListener("beforeunload",function(e){if(!window.formSubmitting){var a=wksap_ajax_object.translation.confirmationMessage+wksap_ajax_object.translation.confirmationMessage2;return(e||window.event).returnValue=a,a}})},e(".wksap-cm-confirm").on("click",function(e){if(!confirm(wksap_ajax_object.translation.want_continue))return!1}),e(".wksap-resync-user").on("click",function(){if(wksap_ajax_object?.wksap_enable)if(0==window.disableuser){var r=e(this).prop("id");r=r.replace("resync_",""),real_user_id=e("#wksap_real_pid_"+r).html(),Swal.fire({title:wksap_ajax_object.translation.are_you_sure,text:wksap_ajax_object.translation.you_want_sync,icon:"warning",showCancelButton:!0,confirmButtonColor:"#2ea2cc",cancelButtonColor:"#d33",confirmButtonText:wksap_ajax_object.translation.sync_it}).then(e=>{e.isConfirmed&&(window.user_item_ids=new Array,window.user_item_ids.push(r),msgBlock=a("clock_block_export_user"),o("updated",wksap_ajax_object.translation.export_start,msgBlock),window.stop_clock="no",t("clock_block_export_user"),window.user_item_ids.length>0&&(window.disableuser=!0,n(window.user_item_ids.length,window.user_item_ids.length,1,0,0,0,0,0)))})}else window.disableuser=!1,s(wksap_ajax_object.translation.cannot_start,wksap_ajax_object.translation.another_is_going);else Swal.fire({title:wksap_ajax_object.translation.error,text:wksap_ajax_object.translation.enable_plugin,icon:"error",showConfirmButton:!0,timer:3e3})}),e("#wksap_syncronize_user_button").on("click",function(){wksap_ajax_object?.wksap_enable?0==window.disableuser?Swal.fire({text:wksap_ajax_object.translation.export_option,input:"select",padding:"1.6rem",inputOptions:{created:wksap_ajax_object.translation.date_created,all:wksap_ajax_object.translation.export_all},inputPlaceholder:wksap_ajax_object.translation.export_basis,type:"warning",confirmButtonColor:" #2ea2cc",cancelButtonColor:"#d33",confirmButtonText:wksap_ajax_object.translation.next,showCancelButton:!0,inputValidator:e=>new Promise(a=>{""!==e?a():a(wksap_ajax_object.translation.select_option)})}).then(a=>{if(a.isConfirmed){selectedoption=a.value;let i="created"===selectedoption?wksap_ajax_object.translation.order_create_between:wksap_ajax_object.translation.order_modified_between;if("created"==selectedoption||"modified"==selectedoption)Swal.fire({title:i,width:600,html:' <span class="mb-0" ><input class="form-control form-control-solid" placeholder="'+wksap_ajax_object.translation.pick_date_range+'" id="kt_daterangepicker_2" autocomplete="off"/></span> &nbsp;And &nbsp;<span class="mb-0"><input class="form-control form-control-solid" placeholder="'+wksap_ajax_object.translation.pick_date_range+'" id="kt_daterangepicker_3" autocomplete="off"/></span>',showCancelButton:!0,showDenyButton:!0,denyButtonText:wksap_ajax_object.translation.back,confirmButtonColor:"#2ea2cc",denyButtonColor:"#6e7881",cancelButtonColor:"#d33",confirmButtonText:wksap_ajax_object.translation.confirm,cancelButtonText:wksap_ajax_object.translation.cancel,preConfirm:()=>[e("#kt_daterangepicker_2").val(),e("#kt_daterangepicker_3").val()],willOpen:function(){e("#kt_daterangepicker_2").daterangepicker({timePicker:!0,singleDatePicker:!0,showDropdowns:!0,minYear:1901,linkedCalendars:!1,timePickerSeconds:!0,locale:{format:"YYYY/MM/DD hh:mm A"}}),e("#kt_daterangepicker_3").daterangepicker({timePicker:!0,singleDatePicker:!0,showDropdowns:!0,minYear:1901,linkedCalendars:!1,timePickerSeconds:!0,locale:{format:"YYYY/MM/DD hh:mm A"}})}}).then(a=>{if(a.isConfirmed)if(selected_date_range=a.value,selected_date_range[0]<=selected_date_range[1]){if(0==window.disableuser){window.disableuser=!0;var t=e("#wksap_elm_synced_items").prop("checked"),n=e("#wksap_elm_unsynced_items").prop("checked"),r=e("#wksap_elm_error_items").prop("checked");sync=t&&n?"A":t?"S":n?"U":r?"E":"N",function(e,a,t="",n="",s="",r="wksap_export_object_with_background_job"){jQuery.ajax({type:"POST",url:wksap_ajax_object.wksap_ajax,data:{action:r,sync:e,sObject:a,start_date:t,end_date:n,option:s,wksap_nonce:wksap_ajax_object.wksap_nonce},beforeSend:function(){Swal.fire({title:wksap_ajax_object.translation.finding,text:wksap_ajax_object.translation.wait,allowOutsideClick:!1,allowEscapeKey:!1,showConfirmButton:!1,didOpen:()=>{Swal.showLoading()}})},success:function(e){var a=jQuery.parseJSON(e);"warning"==a.code?Swal.fire({title:wksap_ajax_object.translation.background_job,text:a.message,icon:a.code,timer:2e3,showConfirmButton:!1,showCancelButton:!1,timer:2e3}):Swal.fire({title:wksap_ajax_object.translation.background_job,text:a.message,icon:a.code,timer:2e3,showConfirmButton:!1,showCancelButton:!1,timer:2e3}).then(e=>{location.reload()})},error:function(e){o("error",wksap_ajax_object.translation.error_ex,e.responseText)}})}(sync,"user",selected_date_range[0],selected_date_range[1],selectedoption)}}else s(wksap_ajax_object.translation.invalid_date,wksap_ajax_object.translation.before_date);else a?.isDenied&&e("#wksap_syncronize_user_button").trigger("click")});else if("all"==selectedoption&&0==window.disableuser){window.disableuser=!0;var t=e("#wksap_elm_synced_items").prop("checked"),n=e("#wksap_elm_unsynced_items").prop("checked"),r=e("#wksap_elm_error_items").prop("checked");sync=t&&n?"A":t?"S":n?"U":r?"E":"N",function(e,a,t="",n="",s="",r="wksap_export_object_with_background_job"){if(!wksap_ajax_object?.wksap_enable)return void Swal.fire({title:wksap_ajax_object.translation.error,text:wksap_ajax_object.translation.enable_plugin,icon:"error",showConfirmButton:!0,timer:3e3});jQuery.ajax({type:"POST",url:wksap_ajax_object.wksap_ajax,data:{action:r,sync:e,sObject:a,start_date:t,end_date:n,option:s,wksap_nonce:wksap_ajax_object.wksap_nonce},beforeSend:function(){Swal.fire({title:wksap_ajax_object.translation.finding,text:wksap_ajax_object.translation.wait,allowOutsideClick:!1,allowEscapeKey:!1,showConfirmButton:!1,didOpen:()=>{Swal.showLoading()}})},success:function(e){var a=jQuery.parseJSON(e);let t="";Swal.fire({title:wksap_ajax_object.translation.background_job,html:`${a.message}${t}`,icon:a.code,showConfirmButton:!0,showCancelButton:!1}).then(e=>{location.reload()})},error:function(e){o("error",wksap_ajax_object.translation.error_ex,e.responseText)}})}(sync,"user",start_date="",end_date="",option="",url="wksap_export_object_with_background_jobs")}}}):(window.disableuser=!1,s(wksap_ajax_object.translation.cannot_start,wksap_ajax_object.translation.another_is_going)):Swal.fire({title:wksap_ajax_object.translation.error,text:wksap_ajax_object.translation.enable_plugin,icon:"error",showConfirmButton:!0,timer:3e3})}),e("#wksap-sync-limit-check").on("click",function(){e(this).is(":checked")?e("#woosap-sync-limit").prop("disabled",!1):e("#woosap-sync-limit").prop("disabled",!0)}),e("#wksap-deletelog").on("click",function(){confirm(wksap_ajax_object.translation.last_seven_days)&&jQuery.ajax({type:"POST",url:wksap_ajax_object.wksap_ajax,data:{action:"wksap_delete_generated_log_files",wksap_nonce:wksap_ajax_object.wksap_nonce},success:function(e){window.location.search+="&action=logsdeleted"}})}),e(".target").click(function(){e.post(ajax_object.ajaxurl,{action:"ajax_action",post_id:e(this).find("input.post_id").attr("value")},function(e){alert(e)})}),e(document).on("click",".notice-dismiss",function(){"no"==window.stop_clock?confirm(wksap_ajax_object.translation.are_you_sure_delete_log_file)&&e(this).parent().remove():e(this).parent().remove()}),e(document).on("click","#doaction, #doaction2",function(r){if(!wksap_ajax_object?.wksap_enable)return Swal.fire({title:wksap_ajax_object.translation.error,text:wksap_ajax_object.translation.enable_plugin,icon:"error",showConfirmButton:!0,timer:3e3}),!1;var c=e("#bulk-action-selector-top").val();if("doaction"==e(this).prop("id")){if("-1"==c)return r.preventDefault(),!1;"exportUsers"==c&&(r.preventDefault(),"no"==window.stop_clock?Swal.fire({title:wksap_ajax_object.translation.are_you_sure,text:wksap_ajax_object.translation.are_you_sure_export_user,icon:"warning",showCancelButton:!0,confirmButtonColor:"#28a745",cancelButtonColor:"#d33",confirmButtonText:wksap_ajax_object.translation.sync_it}).then(e=>{e.isConfirmed&&(window.user_item_ids=new Array,jQuery("input[name='mergeduser[]']:checkbox").each(function(){1==jQuery(this).prop("checked")&&(item_id=jQuery(this).val(),window.user_item_ids.push(item_id))}),window.user_item_ids.length>0?(msgBlock=a("clock_block_export_user"),o("updated",wksap_ajax_object.translation.export_start,msgBlock),window.stop_clock="no",t("clock_block_export_user"),n(window.user_item_ids.length,window.user_item_ids.length,1,0,0,0,0,0)):s(wksap_ajax_object.translation.select_user,wksap_ajax_object.translation.sap_partner))}):(window.user_item_ids=new Array,jQuery("input[name='mergeduser[]']:checkbox").each(function(){1==jQuery(this).prop("checked")&&(item_id=jQuery(this).val(),window.user_item_ids.push(item_id))}),window.user_item_ids.length>0?(msgBlock=a("clock_block_export_user"),o("updated",wksap_ajax_object.translation.export_start,msgBlock),window.stop_clock="no",t("clock_block_export_user"),n(window.user_item_ids.length,window.user_item_ids.length,1,0,0,0,0,0)):s(wksap_ajax_object.translation.select_user,wksap_ajax_object.translation.sap_partner))),"delete-user"!=c&&"delete-all-user"!=c||(r.preventDefault(),i(c,"user"))}}),e("#wksap-export-stop-user-button").on("click",function(){Swal.fire({title:wksap_ajax_object.translation.records_already,text:wksap_ajax_object.translation.records_already_stop,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",confirmButtonText:wksap_ajax_object.translation.stop_it}).then(e=>{var a;e.isConfirmed&&(a="user",jQuery.ajax({type:"POST",url:wksap_ajax_object.wksap_ajax,data:{action:"wksap_stop_background_job",sObject:a,wksap_nonce:wksap_ajax_object.wksap_nonce},beforeSend:function(){},success:function(e){var a=jQuery.parseJSON(e);Swal.fire({title:wksap_ajax_object.translation.background_job,text:a.message,icon:a.code,timer:2e3,showConfirmButton:!1,showCancelButton:!1}).then(e=>{location.reload()})},error:function(e){o("error",wksap_ajax_object.translation.error_ex,e.responseText)}}))})})}),window.connectionType="";